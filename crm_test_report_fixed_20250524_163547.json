{
  "tests": [
    {
      "test": "SUPABASE_URL",
      "status": "PASS",
      "message": "Found: https://jq...",
      "timestamp": "2025-05-24T16:34:59.709232"
    },
    {
      "test": "SUPABASE_ANON_KEY",
      "status": "PASS",
      "message": "Found: eyJhbGciOi...",
      "timestamp": "2025-05-24T16:34:59.710233"
    },
    {
      "test": "OPENAI_API_KEY",
      "status": "PASS",
      "message": "Found: sk-proj-wB...",
      "timestamp": "2025-05-24T16:34:59.710233"
    },
    {
      "test": "CALENDLY_ACCESS_TOKEN",
      "status": "PASS",
      "message": "Found: eyJraWQiOi...",
      "timestamp": "2025-05-24T16:34:59.710233"
    },
    {
      "test": "Supabase Client Init",
      "status": "PASS",
      "message": "Client created successfully",
      "timestamp": "2025-05-24T16:35:00.043069"
    },
    {
      "test": "Health Check",
      "status": "PASS",
      "message": "Database connection OK",
      "timestamp": "2025-05-24T16:35:01.143479"
    },
    {
      "test": "Basic Query",
      "status": "PASS",
      "message": "Query executed, found 1 leads",
      "timestamp": "2025-05-24T16:35:01.368328"
    },
    {
      "test": "Stats Query",
      "status": "PASS",
      "message": "Stats retrieved, total leads: 4, qualified: 4, contacted: 3, meetings: 4, conversations: 4 (active: 0)",
      "timestamp": "2025-05-24T16:35:03.057941"
    },
    {
      "test": "LeadAgent Init",
      "status": "PASS",
      "message": "Agent initialized",
      "timestamp": "2025-05-24T16:35:03.539127"
    },
    {
      "test": "LeadAgent Tools",
      "status": "PASS",
      "message": "Found 4 function calling tools",
      "timestamp": "2025-05-24T16:35:03.539127"
    },
    {
      "test": "OutboundAgent Init",
      "status": "PASS",
      "message": "Agent initialized",
      "timestamp": "2025-05-24T16:35:04.097015"
    },
    {
      "test": "OutboundAgent Tools",
      "status": "PASS",
      "message": "Found 3 function calling tools",
      "timestamp": "2025-05-24T16:35:04.097015"
    },
    {
      "test": "MeetingSchedulerAgent Init",
      "status": "PASS",
      "message": "Agent initialized",
      "timestamp": "2025-05-24T16:35:04.590701"
    },
    {
      "test": "MeetingSchedulerAgent Tools",
      "status": "PASS",
      "message": "Found 4 function calling tools",
      "timestamp": "2025-05-24T16:35:04.590701"
    },
    {
      "test": "Create Lead Operation",
      "status": "PASS",
      "message": "Lead created with ID: f21771a8-368f-4877-8d89-5c795b249494",
      "timestamp": "2025-05-24T16:35:05.422204"
    },
    {
      "test": "Get Lead Operation",
      "status": "PASS",
      "message": "Lead retrieved successfully",
      "timestamp": "2025-05-24T16:35:05.659662"
    },
    {
      "test": "Get Lead by Email",
      "status": "PASS",
      "message": "Lead found by email",
      "timestamp": "2025-05-24T16:35:05.893833"
    },
    {
      "test": "Mark Lead Qualified",
      "status": "PASS",
      "message": "Lead marked as qualified",
      "timestamp": "2025-05-24T16:35:06.137220"
    },
    {
      "test": "Delete Test Lead",
      "status": "PASS",
      "message": "Test lead cleaned up",
      "timestamp": "2025-05-24T16:35:06.376311"
    },
    {
      "test": "Agents System Init",
      "status": "PASS",
      "message": "Agents system initialized",
      "timestamp": "2025-05-24T16:35:08.068585"
    },
    {
      "test": "Complete Workflow",
      "status": "PASS",
      "message": "Lead ID: db87747e-3cbf-48d1-a70e-1658ddb2fd80, Qualified: True",
      "timestamp": "2025-05-24T16:35:42.858030"
    },
    {
      "test": "Lead Qualification",
      "status": "PASS",
      "message": "Lead qualified successfully",
      "timestamp": "2025-05-24T16:35:42.858030"
    },
    {
      "test": "Outbound Contact",
      "status": "PASS",
      "message": "Message: Hola Carlos, gracias por contactarnos desde Test T...",
      "timestamp": "2025-05-24T16:35:42.858030"
    },
    {
      "test": "Meeting Scheduling",
      "status": "PASS",
      "message": "Type: Sales Call, URL: https://calendly.com/your-company/sales-call-d850d531",
      "timestamp": "2025-05-24T16:35:42.858030"
    },
    {
      "test": "Lead Persistence",
      "status": "PASS",
      "message": "Lead found in database: test.lead.20250524163508@testcompany.com",
      "timestamp": "2025-05-24T16:35:43.646258"
    },
    {
      "test": "Lead Status Update",
      "status": "PASS",
      "message": "Lead marked as qualified",
      "timestamp": "2025-05-24T16:35:43.646258"
    },
    {
      "test": "Contact Status Update",
      "status": "PASS",
      "message": "Lead marked as contacted",
      "timestamp": "2025-05-24T16:35:43.646258"
    },
    {
      "test": "Meeting Status Update",
      "status": "PASS",
      "message": "Meeting scheduled",
      "timestamp": "2025-05-24T16:35:43.646258"
    },
    {
      "test": "Conversation Creation",
      "status": "PASS",
      "message": "Found 1 conversations",
      "timestamp": "2025-05-24T16:35:43.866190"
    },
    {
      "test": "Test Lead Deletion",
      "status": "FAIL",
      "message": "Error deleting lead: {'message': 'update or delete on table \"leads\" violates foreign key constraint \"conversations_lead_id_fkey\" on table \"conversations\"', 'code': '23503', 'hint': None, 'details': 'Key is still referenced from table \"conversations\".'}",
      "timestamp": "2025-05-24T16:35:46.008221"
    },
    {
      "test": "Stats Consistency",
      "status": "PASS",
      "message": "Lead count updated: 5 -> 5",
      "timestamp": "2025-05-24T16:35:47.347653"
    }
  ],
  "summary": {
    "overall_status": "\u26a0\ufe0f WARNING",
    "total_passed": 30,
    "total_failed": 1,
    "failed_tests": [
      "   \u2022 Test Lead Deletion - Error deleting lead: {'message': 'update or delete on table \"leads\" violates foreign key constraint \"conversations_lead_id_fkey\" on table \"conversations\"', 'code': '23503', 'hint': None, 'details': 'Key is still referenced from table \"conversations\".'}"
    ],
    "category_results": {
      "ENVIRONMENT": {
        "passed": true,
        "error": null
      },
      "DATABASE": {
        "passed": true,
        "error": null
      },
      "AGENTS": {
        "passed": true,
        "error": null
      },
      "SUPABASE_OPS": {
        "passed": true,
        "error": null
      },
      "WORKFLOW": {
        "passed": true,
        "error": null
      },
      "CLEANUP": {
        "passed": true,
        "error": null
      }
    }
  }
}