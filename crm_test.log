2025-05-24 12:02:39,809 - __main__ - ERROR - Database connection error: SUPABASE_URL and SUPABASE_ANON_KEY environment variables required
2025-05-24 12:02:39,810 - __main__ - ERROR - Traceback (most recent call last):
  File "D:\Mis_Docs\Enprendimiento\Proyectos\lead-crm-agent\__main__.py", line 152, in test_database_connection
    self.db_client = SupabaseCRMClient()
                     ^^^^^^^^^^^^^^^^^^^
  File "D:\Mis_Docs\Enprendimiento\Proyectos\lead-crm-agent\app\supabase\supabase_client.py", line 31, in __init__
    raise ValueError(
ValueError: SUPABASE_URL and SUPABASE_ANON_KEY environment variables required

2025-05-24 12:02:40,547 - __main__ - ERROR - LeadAgent error: SUPABASE_URL and SUPABASE_ANON_KEY environment variables required
2025-05-24 12:02:40,789 - __main__ - ERROR - OutboundAgent error: SUPABASE_URL and SUPABASE_ANON_KEY environment variables required
2025-05-24 12:02:41,025 - __main__ - ERROR - MeetingSchedulerAgent error: SUPABASE_URL and SUPABASE_ANON_KEY environment variables required
2025-05-24 12:09:34,629 - app.supabase.supabase_client - INFO - Supabase CRM Client initialized
2025-05-24 12:09:35,992 - httpx - INFO - HTTP Request: GET https://jqnfcscgtcawazgdwxsh.supabase.co/rest/v1/leads?select=id&limit=1 "HTTP/2 200 OK"
2025-05-24 12:09:36,533 - httpx - INFO - HTTP Request: GET https://jqnfcscgtcawazgdwxsh.supabase.co/rest/v1/leads?select=%2A&order=created_at.desc&offset=0&limit=1 "HTTP/2 200 OK"
2025-05-24 12:09:36,766 - httpx - INFO - HTTP Request: GET https://jqnfcscgtcawazgdwxsh.supabase.co/rest/v1/leads?select=id "HTTP/2 200 OK"
2025-05-24 12:09:36,983 - httpx - INFO - HTTP Request: GET https://jqnfcscgtcawazgdwxsh.supabase.co/rest/v1/leads?select=id&qualified=eq.True "HTTP/2 200 OK"
2025-05-24 12:09:37,528 - httpx - INFO - HTTP Request: GET https://jqnfcscgtcawazgdwxsh.supabase.co/rest/v1/leads?select=id&contacted=eq.True "HTTP/2 200 OK"
2025-05-24 12:09:37,762 - httpx - INFO - HTTP Request: GET https://jqnfcscgtcawazgdwxsh.supabase.co/rest/v1/leads?select=id&meeting_scheduled=eq.True "HTTP/2 200 OK"
2025-05-24 12:09:38,320 - httpx - INFO - HTTP Request: GET https://jqnfcscgtcawazgdwxsh.supabase.co/rest/v1/conversations?select=id "HTTP/2 200 OK"
2025-05-24 12:09:38,562 - httpx - INFO - HTTP Request: GET https://jqnfcscgtcawazgdwxsh.supabase.co/rest/v1/conversations?select=id&status=eq.active "HTTP/2 200 OK"
2025-05-24 12:09:39,061 - app.supabase.supabase_client - INFO - Supabase CRM Client initialized
2025-05-24 12:09:39,556 - app.supabase.supabase_client - INFO - Supabase CRM Client initialized
2025-05-24 12:09:40,050 - app.supabase.supabase_client - INFO - Supabase CRM Client initialized
2025-05-24 12:09:40,761 - httpx - INFO - HTTP Request: POST https://jqnfcscgtcawazgdwxsh.supabase.co/rest/v1/leads "HTTP/2 401 Unauthorized"
2025-05-24 12:09:40,761 - app.supabase.supabase_client - ERROR - Error in create_lead: {'message': 'new row violates row-level security policy for table "leads"', 'code': '42501', 'hint': None, 'details': None}
2025-05-24 12:09:40,761 - app.supabase.supabase_client - ERROR - API Error details: None
2025-05-24 12:09:40,761 - __main__ - ERROR - Supabase operations error: {'message': 'new row violates row-level security policy for table "leads"', 'code': '42501', 'hint': None, 'details': None}
2025-05-24 12:09:40,761 - __main__ - ERROR - Traceback (most recent call last):
  File "D:\Mis_Docs\Enprendimiento\Proyectos\lead-crm-agent\__main__.py", line 313, in test_supabase_operations
    created_lead = self.db_client.create_lead(test_lead_data)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Mis_Docs\Enprendimiento\Proyectos\lead-crm-agent\app\supabase\supabase_client.py", line 78, in create_lead
    self._handle_error("create_lead", e)
  File "D:\Mis_Docs\Enprendimiento\Proyectos\lead-crm-agent\app\supabase\supabase_client.py", line 69, in create_lead
    result = self.client.table("leads").insert(lead_dict).execute()
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Mis_Docs\Enprendimiento\Proyectos\lead-crm-agent\.venv\Lib\site-packages\postgrest\_sync\request_builder.py", line 78, in execute
    raise APIError(dict(json_obj))
postgrest.exceptions.APIError: {'message': 'new row violates row-level security policy for table "leads"', 'code': '42501', 'hint': None, 'details': None}

2025-05-24 12:09:41,013 - app.supabase.supabase_client - INFO - Supabase CRM Client initialized
2025-05-24 12:09:41,507 - app.supabase.supabase_client - INFO - Supabase CRM Client initialized
2025-05-24 12:09:42,004 - app.supabase.supabase_client - INFO - Supabase CRM Client initialized
2025-05-24 12:09:42,501 - app.supabase.supabase_client - INFO - Supabase CRM Client initialized
2025-05-24 12:09:42,501 - app.agents.agent - INFO - LeadProcessor initialized with function calling agents
2025-05-24 12:09:42,501 - app.agents.agent - INFO - Agents system initialized with automated function calling
2025-05-24 12:09:43,518 - httpx - INFO - HTTP Request: GET https://jqnfcscgtcawazgdwxsh.supabase.co/rest/v1/leads?select=%2A&email=eq.test.lead.20250524120940%40testcompany.com "HTTP/2 200 OK"
